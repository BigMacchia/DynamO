#    DYNAMO:- Event driven molecular dynamics simulator 
#    http://www.marcusbannerman.co.uk/dynamo
#    Copyright (C) 2009  Marcus N Campbell Bannerman <m.bannerman@gmail.com>
#
#    This program is free software: you can redistribute it and/or
#    modify it under the terms of the GNU General Public License
#    version 3 as published by the Free Software Foundation.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program.  If not, see <http://www.gnu.org/licenses/>.

import ../magnet/jam/filetypes ;
import ../magnet/jam/tags ;
import ../magnet/jam/builddep ;

lib cwiid : : <link>shared : : <define>COIL_wiimote ;
exe cwiidtest : tests/wiimote.cpp cwiid ;

project	: requirements
          #This creates a feature coil-integration, which can be set
          #on the command line or auto-detected using the passed target
	  [ builddep.set-feature-on-build coil-cwiid 
            : cwiidtest
            : "Coil: Wii-mote support (libCwiid)" ]
	: default-build release
	: build-dir $(BUILD_DIR_PATH)
	;

lib glut : : <link>shared ;
lib GLU  : : <link>shared ;
lib GL   : : <link>shared ;
lib Xext : : <link>shared ;
lib X11  : : <link>shared ;
lib rt   : : <link>shared ;
lib GLEW : : <link>shared ;
alias gtkmm : : : : <linkflags>"`pkg-config gtkmm-2.4 --libs`" <cflags>"`pkg-config gtkmm-2.4 --cflags`" ;

#Test executables for determining what is available in the build environment
exe gluttest : tests/gluttest.cpp glut ;
exe gtkmmtest : tests/gtkmmtest.cpp gtkmm ;
exe GLEWtest : tests/glewtest.cpp ;

exe coilDependencies : tests/buildreq.cpp : 
[ check-target-builds /opencl//test "Coil: OpenCL" : : <define>BUILDFAIL ]
[ check-target-builds gluttest "Coil: FreeGlut" : : <define>BUILDFAIL ]
[ check-target-builds gtkmmtest "Coil: GTKmm" : : <define>BUILDFAIL ]
[ check-target-builds GLEWtest "Coil: GLEW" : : <define>BUILDFAIL ]
: : ;

always cwiidtest gluttest gtkmmtest GLEWtest coilDependencies ;
explicit cwiidtest gluttest gtkmmtest GLEWtest coilDependencies ;

rule critical_dependencies ( )
{ return [ check-target-builds coilDependencies "Coil library dependencies" :  : <build>no ] ; }

lib coil 
      : [ glob-tree *.cpp : tests examples images ]
        [ glob-tree *.pixbufsvg *.ttf : tests examples coil ]
      clwingtk.gladexml
      glut GLU GL Xext X11 rt GLEW /magnet//magnet
      /opencl//opencl gtkmm /boost//system
      : <include>. <include>../boost <tag>@tags.lib-naming 
       <coil-cwiid>yes:<source>cwiid
      : : <define>GLVIEWER <include>. ;

exe gl_test
    : tests/glviewer_test.cpp coil/<link>static
    ;

explicit gl_test test coil ;

install install-libs
	: coil coil/<link>static
	: <location>$(LIB_INSTALL_PATH) [ critical_dependencies ]
	;	

install install-headers
	: [ glob coil/*.hpp coil/*/*.hpp coil/*/*/*.hpp ]
	: <location>$(INCLUDE_INSTALL_PATH) <install-source-root>./ [ critical_dependencies ]
	;

alias install-coil : install-libs install-headers ;

exe coilparticletest : examples/particletest.cpp coil ;